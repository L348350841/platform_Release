(function(){"use strict";var t={3379:function(t,e,a){var s={};a.r(s),a.d(s,{addParaValue:function(){return R},checkCollection:function(){return q},delParaValue:function(){return L},getCenterPoint:function(){return B},getFreshiftData:function(){return C},getFreshiftTimeList:function(){return P},getOneData:function(){return _},getOriginData:function(){return O},getParaItem:function(){return V},getParaList:function(){return T},getParaMenu:function(){return S},getParaValue:function(){return E},getPathPoint:function(){return z},getStrainData:function(){return I},getStrainTimeList:function(){return A},getSubMenu:function(){return F},getTempData:function(){return D},login:function(){return N},resetBinFactory:function(){return J},resetSysFactory:function(){return j},setParaValue:function(){return $},setPoint:function(){return Z},startCollect:function(){return H},uploadBit:function(){return G},uploadSystem:function(){return W}});var i=a(5471),o=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},n=[],r=a(5353);const l={NOLOG:0,ADMIN:1,COMMON:2},c={TEMP:0,STRAIN:1,FRE:2,ONE:3,ORIGIN:4},h={0:"温度折线图",1:"应变折线图",2:"频率折线图",3:"某点频率图",4:"原始图"};var u={roleDis:l,dataMode:c,dataDesc:h};i["default"].use(r.Ay);var d=new r.Ay.Store({state:{role:u.roleDis["NOLOG"],userName:"",activeMenu:0,openNames:[]},mutations:{setRole:function(t,e){t.role=e},setName:function(t,e){t.userName=e},setActiveMenu(t,e){t.activeMenu=e},setOpenNames(t,e){t.openNames=e}},actions:{},modules:{}}),p={computed:{...(0,r.aH)([d.state])},created(){console.log("App.vue加载成功"),sessionStorage.getItem(d)&&(this.$store.replaceState(Object.assign({},this.$store.state,JSON.parse(sessionStorage.getItem(d)))),console.log("app:缓存vuex信息",d.state))}},m=p,g=a(1656),f=(0,g.A)(m,o,n,!1,null,null,null),v=f.exports,y=(a(8992),a(7550),a(173)),b=function(){var t=this,e=t._self._c;return e("div",{staticClass:"home"},[e("div",{staticClass:"menu"},[e("div",{staticClass:"menu-title"},[t._v("数据采集控制平台")]),e("Menu",{staticClass:"home-menu",attrs:{theme:"light","active-name":this.activeMenu}},[t._l(t.menus,(function(a,s){return[a.children?e("Submenu",{key:s,attrs:{name:s}},[e("template",{slot:"title"},[e("Icon",{attrs:{type:a.meta.icon}}),t._v(" "+t._s(a.meta.title)+" ")],1),t._l(t.paraMenu,(function(a){return e("MenuItem",{key:a.mid,attrs:{name:"3-"+a.mcode,to:"table?mcode="+a.mcode+"&mid="+a.mid+"&mname="+a.name}},[t._v(" "+t._s(a.name)+" ")])}))],2):e("MenuItem",{key:s,attrs:{name:s,to:a.path.replace(/\//,"")}},[e("Icon",{attrs:{type:a.meta.icon}}),t._v(" "+t._s(a.meta.title)+" ")],1)]}))],2)],1),e("div",{staticClass:"content"},[e("monitor"),e("router-view")],1)])},w=[],M=a(4335);M.A.defaults.timeout=6e3;const k=M.A.create({timeout:1e4});k.interceptors.response.use((function(t){return 200===t.status?t.data:Promise.reject(t)}),(function(t){return Promise.reject(t)}));var x=k;function S(t){return x.post("api/getParaMenu",t)}function C(t){return x.post("api/getFreshiftData",t)}function D(t){return x.post("api/getTempData",t)}function _(t){return x.post("api/getOneData",t)}function P(){return x.get("api/getFreshiftTime")}function I(t){return x.get("api/getStrainData",t)}function A(){return x.get("api/getStrainTime")}function O(){return x.get("api/getOriginData")}function N(t){return x.post("api/login",t)}function F(t){return x.post("api/getSubMenu",t)}function T(t){return x.post("api/getParaList",t)}function V(t){return x.post("api/getParaItem",t)}function R(t){return x.post("api/addParaValue",t)}function L(t){return x.post("api/delParaValue",t)}function $(t){return x.post("api/setParaValue",t)}function E(t){return x.post("api/getParaValue",t)}function B(){return x.get("api/getCenterPoint")}function z(){return x.get("api/getPathPoint")}function Z(t){return x.post("api/setPoint",t)}function H(t){return x.post("api/startCollect",t)}function q(){return x.get("api/checkCollection")}function G(t){return x.post("api/uploadBit",t)}function W(t){return x.post("api/uploadSystem",t)}function J(t){return x.post("api/resetBinFactory",t)}function j(t){return x.post("api/resetSysFactory",t)}var Y=function(){var t=this,e=t._self._c;return e("div",{staticClass:"monitor"},[e("div",{staticClass:"monitor-name"},[t._v(" 您好，"+t._s(t.userName)+" ")]),e("div",{staticClass:"exit"},[e("Button",[e("a",{on:{click:t.clickName}},[t._v("退出")])])],1)])},U=[],X=(a(4114),{name:"monitorMenu",computed:{...(0,r.aH)(["userName"])},methods:{clickName(){this.$store.commit("setRole",u.roleDis["NOLOG"]),this.$store.commit("setName",""),this.$router.push("/login")}}}),K=X,Q=(0,g.A)(K,Y,U,!1,null,"b3ec6bc6",null),tt=Q.exports,et=function(){var t=this,e=t._self._c;return e("div",{staticClass:"chart"},[e("Row",{staticClass:"chart-title"},[t._v(" 数据曲线 ")]),e("Row",[e("Tabs",{model:{value:t.mode,callback:function(e){t.mode=e},expression:"mode"}},[e("TabPane",{attrs:{label:"温度数据",name:t.dataMode.TEMP.toString()}}),e("TabPane",{attrs:{label:"应变数据",name:t.dataMode.STRAIN.toString()}}),e("TabPane",{attrs:{label:"频移数据",name:t.dataMode.FRE.toString()}}),e("TabPane",{attrs:{label:"某点数据",name:t.dataMode.ONE.toString()}}),e("TabPane",{attrs:{label:"原始数据",name:t.dataMode.ORIGIN.toString()}})],1)],1),e("Row",[e("div",{staticClass:"chart-selector"},[t.mode!==t.dataMode.ONE.toString()?[e("Select",{staticStyle:{width:"150px"},on:{"on-change":t.selectTime},model:{value:t.displayTime,callback:function(e){t.displayTime=e},expression:"displayTime"}},t._l(t.timeList,(function(a){return e("Option",{key:a.value,attrs:{value:a.value}},[t._v(t._s(a.label))])})),1)]:[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("Input",{staticStyle:{width:"150px","margin-right":"10px"},model:{value:t.oneinputValue,callback:function(e){t.oneinputValue=e},expression:"oneinputValue"}}),e("Button",{on:{click:t.oneButtonClick}},[t._v("查看具体位置数据（m）")])],1)]],2)]),e("Row",[e("div",{staticClass:"chart-wrap"},[t.loading&&t.trans?e("div",{staticClass:"chart-mask"},[e("Spin",{attrs:{fix:""}},[e("Icon",{staticClass:"demo-spin-icon-load",attrs:{type:"ios-loading",size:"18"}}),e("div",[t._v("加载中")])],1)],1):t._e(),e("div",{staticClass:"chart-content"},[e("div",{ref:"chartRef",staticClass:"echartBox",style:{width:"100%",height:"100%"},attrs:{id:"myChart"}})])])]),e("div",{staticClass:"chart-scope-title"},[t._v(" "+t._s(t.zoomData.label)+" ")]),t._l(t.zoomData.axisInfo,(function(a,s){return e("div",{key:s,staticStyle:{display:"flex",margin:"10px 0 10px 0","align-items":"center"}},[e("span",{staticStyle:{margin:"0 50px 0 30px"}},[t._v(t._s(a.label))]),t._v(" "),e("span",{staticStyle:{margin:"0 10px 0 50px"}},[t._v("从")]),e("Input",{staticStyle:{width:"150px"},model:{value:a.from,callback:function(e){t.$set(a,"from",e)},expression:"item.from"}}),t._v(" "),e("span",{staticStyle:{margin:"0 10px 0px 20px"}},[t._v("到")]),e("Input",{staticStyle:{width:"150px"},model:{value:a.to,callback:function(e){t.$set(a,"to",e)},expression:"item.to"}})],1)})),e("div",{staticStyle:{display:"flex","flex-direction":"row-reverse","margin-top":"20px"}},[e("Button",{staticStyle:{margin:"0 25px 0 20px"},on:{click:t.recvZoom}},[t._v("清空")]),t._v(" "),e("Button",{attrs:{type:"primary"},on:{click:t.setZoom}},[t._v("设置")])],1)],2)},at=[],st=(a(3949),a(1454),{name:"chartView",data(){return{loading:!1,trans:!1,mode:u.dataMode.FRE.toString(),oneinputValue:"",myChart:null,displayTime:0,chartData:[],oneDatax:[],data3D:[],timer:0,interval:6e5,timeList:[{value:0,label:"当前时间"},{value:1,label:"09:34"},{value:2,label:"10:00"},{value:3,label:"10:21"},{value:4,label:"10:56"},{value:5,label:"11:15"}],zoomData:{label:"频移显示范围",axisInfo:[{label:"距离 （M）",from:null,to:null,type:"x"},{label:"频移（无）",from:null,to:null,type:"y"}]},actualZoom:[{type:"x",to:null,from:null},{type:"y",to:null,from:null},{type:"z",to:null,from:null}],zoomFlag:!1}},created(){switch(this.mode){case u.dataMode.TEMP.toString():this.trans=!0,this.getFreshiftTimeList();break;case u.dataMode.STRAIN.toString():this.trans=!0,this.getFreshiftTimeList();break;case u.dataMode.FRE.toString():this.trans=!0,this.getFreshiftTimeList();break;case u.dataMode.ONE.toString():this.trans=!0;break;case u.dataMode.ORIGIN.toString():break;default:break}},mounted(){switch(this.mode){case u.dataMode.TEMP.toString():this.getTempData();break;case u.dataMode.STRAIN.toString():this.getTempData();break;case u.dataMode.FRE.toString():this.getFreshiftData();break;case u.dataMode.ONE.toString():break;case u.dataMode.ORIGIN.toString():this.getOriData(),console.log(this.data3D.length);break;default:break}},computed:{dataMode(){return u.dataMode},chartTitle(){switch(this.mode){case u.dataMode.TEMP.toString():return"温度折线图";case u.dataMode.STRAIN.toString():return"应变折线图";case u.dataMode.FRE.toString():return"频率折线图";case u.dataMode.ONE.toString():return"某点数据折线图";case u.dataMode.ORIGIN.toString():return"原始图";default:return""}},chartYname(){switch(this.mode){case u.dataMode.TEMP.toString():return"温度/℃";case u.dataMode.STRAIN.toString():return"应变值";case u.dataMode.FRE.toString():return"频率/kHz";case u.dataMode.ONE.toString():return"频率/kHz";case u.dataMode.ORIGIN.toString():return"原始图";default:return""}},chartYunit(){switch(this.mode){case u.dataMode.TEMP.toString():return"℃";case u.dataMode.FRE.toString():return"kHz";case u.dataMode.ONE.toString():return"kHz";default:return""}},chartXname(){switch(this.mode){case u.dataMode.TEMP.toString():return"距离/m";case u.dataMode.FRE.toString():return"距离/m";case u.dataMode.ONE.toString():return"时间";default:return""}},limit(){switch(this.mode){case u.dataMode.TEMP.toString():return 39;case u.dataMode.STRAIN.toString():return 15;case u.dataMode.FRE.toString():return 29;case u.dataMode.ONE.toString():return 20;default:return 0}},lineOption(){const t=this.chartData;console.log("284:",t);let e=0,a=t.length-1;void 0!==this.startIndex&&(e=Math.max(0,Math.min(this.startIndex,t.length-1))),void 0!==this.endIndex&&(a=Math.max(0,Math.min(this.endIndex,t.length-1))),e>a&&([e,a]=[a,e]);const s=this.getPointCount(),i=this.filterData(t,s,e,a);return{title:{text:this.chartTitle,left:"center"},tooltip:{trigger:"axis",triggerOn:"click",formatter:t=>{const e=t[0];return`距离: ${e.data[0]}m<br/>${this.chartYname}: ${e.data[1]}kHz`},extraCssText:"text-align: left",padding:10},grid:{left:"3%",right:"8%",bottom:"10%",containLabel:!0},toolbox:{top:0,right:100,feature:{restore:{},saveAsImage:{}}},xAxis:{type:"category",name:this.chartXname,data:this.getXaxis(),min:0,max:this.chartData.length-1,boundaryGap:!1,splitLine:{show:!0,lineStyle:{color:"#999",width:2}}},yAxis:{name:this.chartYname,type:"value",splitLine:{show:!0,lineStyle:{color:"#999",width:2}}},visualMap:{top:0,right:10,pieces:[{gt:0,lte:this.limit,color:"#2b85e4"},{gt:this.limit,color:"red"}]},dataZoom:[{type:"inside",show:!0,xAxisIndex:0,start:e/(t.length-1)*100,end:a/(t.length-1)*100},{type:"slider",xAxisIndex:0,start:e/(t.length-1)*100,end:a/(t.length-1)*100},{type:"slider",yAxisIndex:0},{type:"inside",yAxisIndex:0}],series:[{name:this.chartYname,type:"line",stack:"总量",sampling:"lttb",data:i,symbol:"emptyCircle",smooth:!0,showAllSymbol:"true",symbolSize:5,color:"#2b85e4",markLine:{symbol:"none",silent:!0,label:{position:"start"},data:[{yAxis:this.limit,lineStyle:{color:"#2b85e4"}}]}}]}},lineOption_3D(){return{tooltip:{},title:{text:this.chartTitle,left:"center"},backgroundColor:"#fff",toolbox:{top:0,right:100,feature:{dataZoom:{yAxisIndex:0,xAxisIndex:0},restore:{},saveAsImage:{}}},visualMap:{show:!1,dimension:2,min:0,max:30,inRange:{color:["#313695","#4575b4","#74add1","#abd9e9","#e0f3f8","#ffffbf","#fee090","#fdae61","#f46d43","#d73027","#a50026"]}},xAxis3D:{type:"value"},yAxis3D:{type:"value"},zAxis3D:{type:"value"},grid3D:{viewControl:{projection:"orthographic"}},series:[{type:"surface",data:this.data3D}]}}},beforeDestroy(){this.clearTimer()},watch:{mode(t){let e,a;switch(console.log("mode切换",this.mode),t){case u.dataMode.TEMP.toString():this.trans=!0,e=JSON.parse(JSON.stringify(this.lineOption)),this.myChart.clear(),this.myChart.setOption(e,!0),this.getTempData(),this.initZoom(),this.updateChart(this.chartData),this.zoomData.label="温度显示范围",this.zoomData.axisInfo.forEach((t=>{"y"===t.type&&(t.label="温度（℃）")}));break;case u.dataMode.STRAIN.toString():this.trans=!0,e=JSON.parse(JSON.stringify(this.lineOption)),this.myChart.clear(),this.myChart.setOption(e,!0),this.getTempData(),this.initZoom(),this.updateChart(this.chartData),this.zoomData.label="应变显示范围",this.zoomData.axisInfo.forEach((t=>{"y"===t.type&&(t.label="应变（无）")}));break;case u.dataMode.FRE.toString():this.trans=!0,e=JSON.parse(JSON.stringify(this.lineOption)),this.myChart.clear(),this.myChart.setOption(e,!0),this.getFreshiftData(),this.initZoom(),this.updateChart(this.chartData),this.zoomData.label="频移显示范围",this.zoomData.axisInfo.forEach((t=>{"y"===t.type&&(t.label="频率（Khz）")}));break;case u.dataMode.ONE.toString():this.trans=!0,e=JSON.parse(JSON.stringify(this.lineOption)),this.myChart.clear(),this.zoomData.label="时间显示范围",this.zoomData.axisInfo.forEach((t=>{"y"===t.type&&(t.label="频率（Khz）")}));break;case u.dataMode.ORIGIN.toString():this.trans=!0,this.getOriData(),a=JSON.parse(JSON.stringify(this.lineOption_3D)),console.log("3D",a),this.myChart.clear(),this.myChart.setOption(a,!0);break;default:break}}},methods:{initZoom(){this.zoomFlag=!1,this.actualZoom=[{type:"x",to:null,from:null},{type:"y",to:null,from:null},{type:"z",to:null,from:null}]},startChart(){this.myChart=this.$echarts.init(document.getElementById("myChart")),this.myChart.on("dataZoom",(()=>{const t=this.myChart.getOption(),e=t.dataZoom[0],a=e.start/100*(this.chartData.length-1),s=e.end/100*(this.chartData.length-1),i=t.dataZoom[3];console.log("11569:",t.dataZoom[0]),console.log("11569:",t.dataZoom[3]);const o=i.startValue,n=i.endValue;console.log("aa569:",Math.max(...this.chartData)),console.log("569:",a,s,o,n),this.updateChart(this.chartData,a,s,o,n)})),window.addEventListener("resize",(()=>{this.myChart.resize(),this.updateChart(this.chartData),console.log("resize!!!")})),this.myChart.getZr().on("contextmenu",(t=>{if(t.event&&t.event.preventDefault&&t.event.preventDefault(),this.mode===this.dataMode.TEMP.toString()||this.mode===this.dataMode.STRAIN.toString()||this.mode===this.dataMode.FRE.toString()){const e=[t.offsetX,t.offsetY],a=this.myChart.convertFromPixel("grid",e);if(a){const t=a[0];console.log("649右键点击的 X 轴距离:",t),this.myChart.clear(),this.mode=this.dataMode.ONE.toString(),this.oneinputValue=Math.ceil(t),this.oneButtonClick()}}})),this.myChart.setOption(this.lineOption,!0)},getFreshiftTimeList(){P().then((t=>{1===t.code?(this.timeList=t.data.timeList.map((t=>({value:(new Date(t).getTime()-288e5)/1e3,label:t.toLocaleString()}))),this.timeList.unshift({value:0,label:"当前时间"})):0===t.code&&this.$Message.error(t.message)}))},selectTime(t){if(this.clearTimer(),0===t)switch(this.trans=!1,this.mode){case u.dataMode.TEMP.toString():this.getTempData();break;case u.dataMode.STRAIN.toString():this.getTempData();break;case u.dataMode.FRE.toString():this.getFreshiftData();break;default:break}else switch(this.trans=!0,this.mode){case u.dataMode.TEMP.toString():this.getTempHttp(t);break;case u.dataMode.STRAIN.toString():this.getTempHttp(t);break;case u.dataMode.FRE.toString():console.log("qita:",t),this.getFreshiftHttp(t);break;default:break}this.trans=!1},getXaxis(){let t=[];if(this.mode==u.dataMode.ONE.toString())t=this.oneDatax;else for(let e=0;e<this.chartData.length;e+=1)t.push(e);return t},clearTimer(){console.log("Timer haven cleared!"),clearInterval(this.timer)},getFreshiftData(){this.clearTimer(),this.getFreshiftHttp(0),console.log("Timer start"),this.getFreshiftTimeList(),this.timer=setInterval((()=>{this.trans=!1,console.log("getFREData0"),this.getFreshiftHttp(0)}),this.interval)},oneButtonClick(){console.log("查看具体位置的数据随时间变化：",this.oneinputValue),this.clearTimer(),console.log("Timer start"),this.getOneHttp(this.oneinputValue),this.timer=setInterval((()=>{this.trans=!1,console.log("getFREData0"),this.getOneHttp(this.oneinputValue)}),this.interval)},getTempData(){this.clearTimer(),this.getTempHttp(0),console.log("Timer start"),this.getFreshiftTimeList(),this.timer=setInterval((()=>{this.trans=!1,console.log("getData0"),this.getTempHttp(0)}),this.interval)},getFreshiftHttp(t){console.log("GetFREData--后台查询中time:",t);let e={time:t};this.loading=!0,C(e).then((t=>{1===t.code?(this.chartData=t.data.freshift,console.log("794res:",t),this.startChart(),this.loading=!1):0===t.code&&this.$Message.error(t.message)}))},getTempHttp(t){console.log("GetData--后台查询中");let e={time:t};this.loading=!0,console.log("arg:"),D(e).then((t=>{1===t.code?(this.chartData=t.data.temp,this.startChart(),this.loading=!1):0===t.code&&this.$Message.error(t.message)}))},getOneHttp(t){console.log("789GetData--后台查询中");let e={onedata:t};this.loading=!0,_(e).then((t=>{1===t.code?(this.chartData=t.data.value,this.oneDatax=t.data.time,this.startChart(),this.loading=!1):0===t.code&&this.$Message.error(t.message)}))},getPointCount(){const t=window.innerWidth-540;return console.log("713:图表宽度",t),this.chartData.length>t?t:this.chartData.length},filterData(t,e,a,s){const i=t.slice(a,s+1),o=Math.ceil(2*i.length/e),n=[];for(let r=0;r<i.length;r+=o){const t=Math.min(r+o,i.length),e=i.slice(r,t);let s=-1/0,l=1/0,c=-1,h=-1;for(let i=0;i<e.length;i++)e[i]>s&&(s=e[i],c=r+i+a),e[i]<l&&(l=e[i],h=r+i+a);c<h?(n.push([c,s]),n.push([h,l])):(n.push([h,l]),n.push([c,s]))}return n.slice(0,e)},updateChart(t,e=0,a=null,s=0,i=null){const o=this.getPointCount();console.log("763筛选出数据点数:",o),null===a&&(a=t.length-1),null===i&&(i=Math.max(...t)),console.log("765:",s,i);const n=this.filterData(t,o,e,a);console.log("768:",n);const r={tooltip:{trigger:"axis",triggerOn:"click",axisPointer:{crossStyle:{color:"#999"}},formatter:t=>{const e=t[0];return`距离: ${Math.floor(e.data[0])}m<br/>${this.chartYname}: ${e.data[1]}`}},xAxis:{type:"value",min:0,max:t.length-1,boundaryGap:!1,splitLine:{show:!0,lineStyle:{color:"#999",width:2}}},yAxis:{type:"value",boundaryGap:!1,splitLine:{show:!0,lineStyle:{color:"#999",width:2}}},dataZoom:[{type:"slider",xAxisIndex:0,start:e/(t.length-1)*100,end:a/(t.length-1)*100},{type:"inside",xAxisIndex:0,start:e/(t.length-1)*100,end:a/(t.length-1)*100},{type:"slider",yAxisIndex:0,start:s/Math.max(...t)*100,end:i/Math.max(...t)*100,show:!0,realtime:!0},{type:"inside",yAxisIndex:0,start:s/Math.max(...t)*100,end:i/Math.max(...t)*100}],series:[{data:n,type:"line",symbol:"circle",symbolSize:6,showSymbol:!0,boundaryGap:!1}]};this.myChart.setOption(r)},validateNumber(t){return 0===t||!isNaN(t)&&""!==t&&Boolean(t)},handleError(t){this.$Message.error(t)},validateRange(t,e){let a=!0;const s=Number(t.from),i=Number(t.to);return s>e?(this.handleError("设置值超出最大范围"),a=!1):i>e?(this.handleError("曲线区域显示，设置值应在已有数值范围内"),t.to=e):s>i?[t.from,t.to]=[t.to,t.from]:(s<0||i<0)&&(this.handleError("设置值不可小于0"),a=!1),a},setZoom(){let t=0;const e=Math.max(...this.chartData),a=this.chartData.length;this.zoomData.axisInfo.forEach((s=>{"y"===s.type?(this.validateNumber(s.to)||(t++,s.to=e),this.validateNumber(s.from)||(t++,s.from=0)):"x"===s.type&&(this.validateNumber(s.to)||(t++,s.to=a),this.validateNumber(s.from)||(t++,s.from=0))})),t>0&&this.handleError("输入非数字或范围设置不完整，已自动修正");let s=!0;if(this.zoomData.axisInfo.forEach((t=>{const i="y"===t.type?e:a;this.validateRange(t,i)||(s=!1)})),!s)return 0;this.zoomFlag=!0,this.zoomData.axisInfo.forEach((t=>{const e=t.type;this.actualZoom.forEach((a=>{a.type===e&&(a.to=Number(t.to),a.from=Number(t.from))}))})),console.log("901:",this.actualZoom),this.updateChart(this.chartData,this.actualZoom[0].from,this.actualZoom[0].to,this.actualZoom[1].from,this.actualZoom[1].to)},recvZoom(){console.log("recvZoom--recover:recover"),this.initZoom(),this.updateChart(this.chartData),this.zoomData.axisInfo.forEach((t=>{t.to=null,t.from=null}))},getOriData(){let t=[],e=[],a=[];for(var s=0;s<100;s+=1)for(var i=0;i<100;i+=1)t.push(s),e.push(i),a.push(Math.sin(i/10)*i/10);for(var o=0;o<100;o+=1)for(var n=0;n<100;n+=1){let s=n+100*o;this.data3D.push([t[s],e[s],a[s]])}console.log("data3D:",this.data3D)}}}),it=st,ot=(0,g.A)(it,et,at,!1,null,null,null),nt=ot.exports,rt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"map-area"},[e("baidu-map",{key:t.change,staticClass:"map",attrs:{center:t.center,zoom:t.zoom,"double-click-zoom":!1,"scroll-wheel-zoom":!1,dragging:!1},on:{dragend:t.handleDragEnd,ready:t.onMapReady}},[e("bm-scale",{attrs:{anchor:"BMAP_ANCHOR_TOP_RIGHT"}}),t._l(t.limitPonit,(function(a,s){return e("bm-marker",{key:s,attrs:{position:a,dragging:!1,icon:t.customIcon,offset:{width:0,height:-8}},on:{click:t.clickMark}})})),e("bm-polyline",{attrs:{path:t.locationPoint,"stroke-color":"blue","stroke-opacity":.5,"stroke-weight":8},on:{click:t.clickPoint,lineupdate:t.updatePolylinePath}}),e("bm-control",{attrs:{offset:{width:20,height:10}}},[e("div",{staticClass:"control-panel"},[e("button",{staticClass:"toggle-btn",on:{click:t.toggleControlPanel}},[t._v(" "+t._s(t.showControls?"隐藏控制面板":"显示控制面板")+" ")]),t.showControls?e("div",{staticClass:"control-file"},[e("input",{ref:"upload",staticClass:"outputlist_upload",attrs:{type:"file",accept:".xls,.xlsx"}}),e("div",{staticClass:"control-buttons"},[e("button",{class:{active:t.isDrawing},on:{click:t.toggleDrawing}},[t._v(" "+t._s(t.isDrawing?"结束画线":"开始画线")+" ")]),e("button",{attrs:{disabled:!t.canUndo},on:{click:t.undoLastPoint}},[t._v("撤销上一点")]),e("button",{attrs:{disabled:!t.hasDrawings},on:{click:t.clearAll}},[t._v("清除所有")])])]):t._e()])]),e("bm-control",{attrs:{offset:{width:10,height:120}}},[e("Card",{staticStyle:{width:"150px,"}},[e("div",{staticStyle:{"text-align":"center"}},[e("p",[t._v("地图缩放")]),e("Button",{on:{click:function(e){return t.changeZoom(1)}}},[t._v("+")]),e("Button",{attrs:{type:"primary"},on:{click:function(e){return t.changeZoom(0)}}},[t._v(" 还原 ")]),e("Button",{on:{click:function(e){return t.changeZoom(-1)}}},[t._v("-")])],1)])],1)],2)],1)},lt=[],ct=(a(4520),a(2577),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAZCAYAAADaILXQAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAArlJREFUeNqllt1LU3EYx49Nj5EmLdfWZtHM2XHM7eyssjIhh60ta8WMdmEhgrdR3nTRVQODqFisS/sDgiIoiYgwyKAiki6ySE2DmmZMZ9uqIfTCr+/vdAZy9lt78eJzsbfP8+x5nj3PuFAoxKl5bnKVAx2wPTVJXSNGZ/eDjY6u24ZmYchgr2V9hgVLLIBLYOLVZomMmZ3kDRgzS2QUj/H8C3AWbCpYrmR7AsxObZNIrL2DpIJBkurpIQmfj3xtaSGLdjv5bHWQiQYnDfIS7CtUfhr8/NK+n/wYGCDf+/tJwu2WhSw+CiINEAPu/8rxBh9ILnT6SToSIUm/n8RzSBkBpoGFKccLevAoKraQdDhMEh5PXulyphvlABHAs+Q069+p3l6SDASKElPizXYqXwImlvzilEUk3/r6ihZneFsvN7ibJb8XFXeShNdbslwpzVWWfGhmeytZFMWS5fSbw3OFKf8klC7OJ78fFRwrkmcmhiUfeG9ZWeZ0PcATZMk9r7dIJYsX/o1iItcomsBItMmxkpIMgspcP/8ASNMsihHPYok9M7nm7hrsDo7jKoAGrGItrmvF1J7uHoh/XdcJ5yBsAg2gDqwDPChbLjeCUfo1C5FPYu3e1NseGjT8EYh8wAs6wG5QD1arD4UVzM/kqf8HJIDLNCny1Sch8avoBHvB+qw1ibMWRIA/MVuOOiPwY6MzfrxKf4YhphwEO0BN9g7muPI7hubw+FZnlngeARF86bzWfJkhPQwOgF1gg9xchlzjqlxrxiEenlI1mAYc1Ak3VEJaBg9oAxZQTR3MAy13Gc04VVO3Z9gojmcaTO/mLb1tpFZTcQyvH1Ia6AYuZUqqlHEsy3n9lwXgL2jr254Ypbl3yBgNHDdq+KPKRLSCRqCVp0LJNO9fC3X9qQANJsqIWZV6rlFnyeIvmIDJtcarlTEAAAAASUVORK5CYII="),ht=a(3959),ut={data(){return{customIcon:{url:ct,size:{width:19,height:25}},center:{lng:116.36729,lat:39.967797},zoom:18,chartData:[],interval:5e5,timer:null,locationPoint:[],pointInfo:{lng:116.406,lat:39.915,dis:.007386155969105476,value:17.5564},showWindow:!1,limit:39,limitPonit:{},targetLimit:{},showLimit:!1,datanum:0,PathPoint:[],infoWindow:{contents1:"123",contents2:"456"},pathdata:[],change:!1,file:null,mapReady:!1,map:null,isDrawing:!1,points:[],startMarker:null,currentPolyline:null,polylines:[],showControls:!1}},created(){this.$Notice.config({top:50})},mounted(){this.$refs.upload&&this.$refs.upload.addEventListener("change",(t=>{this.readExcel(t),console.log("change：：",this.change)}))},computed:{canUndo(){return this.isDrawing&&this.points.length>0},hasDrawings(){return this.polylines.length>0||this.points.length>0}},beforeDestroy(){this.clearTimer()},methods:{toggleControlPanel(){this.showControls=!this.showControls},addStartMarker(t){this.startMarker&&this.map.removeOverlay(this.startMarker),this.startMarker=new BMap.Marker(t,{enableMassClear:!1});const e=new BMap.Label("起点",{position:t,offset:new BMap.Size(15,-15)});this.startMarker.setLabel(e),this.map.addOverlay(this.startMarker)},toggleDrawing(){this.isDrawing?this.stopDrawing():this.startDrawing(),this.isDrawing=!this.isDrawing},startDrawing(){this.clearCurrentDrawing(),this.currentPolyline=new BMap.Polyline([],{strokecolor:"blue",strokeopacity:.5,strokeweight:8}),this.map.addOverlay(this.currentPolyline),this.map.addEventListener("click",this.handleMapClick)},stopDrawing(){this.map.removeEventListener("click",this.handleMapClick),this.polylines.length>0&&this.polylines.forEach((t=>{this.map.removeOverlay(t)})),this.polylines=[],this.points.length>=2?(this.polylines.push(this.currentPolyline),console.log("1PathPoint:",this.PathPoint),this.PathPoint=this.points.map((t=>({lng:t.lng,lat:t.lat}))),console.log("2PathPoint:",this.points.map((t=>({lng:t.lng,lat:t.lat})))),this.setPoint()):this.clearCurrentDrawing(),this.startMarker&&(this.map.removeOverlay(this.startMarker),this.startMarker=null),this.currentPolyline=null,this.points=[]},handleMapClick(t){const e=t.point;0===this.points.length&&this.addStartMarker(e),this.addPoint(e)},addPoint(t){this.points.push(t),this.currentPolyline.setPath(this.points)},undoLastPoint(){0!==this.points.length&&(this.points.pop(),0===this.points.length&&this.startMarker&&(this.map.removeOverlay(this.startMarker),this.startMarker=null),this.currentPolyline.setPath(this.points))},clearCurrentDrawing(){this.currentPolyline&&(this.map.removeOverlay(this.currentPolyline),this.currentPolyline=null),this.startMarker&&(this.map.removeOverlay(this.startMarker),this.startMarker=null),this.points=[]},clearAll(){this.limitPonit={},this.locationPoint=[],this.polylines.forEach((t=>{this.map.removeOverlay(t)})),this.polylines=[],this.clearCurrentDrawing(),this.isDrawing&&(this.isDrawing=!1,this.map.removeEventListener("click",this.handleMapClick))},onMapReady({map:t}){this.mapReady=!0,this.map=t,this.getCenter(),this.getPath(),this.getTempData()},handleDragEnd(t){const e=t.target.getCenter();this.center={lat:e.lat,lng:e.lng}},executeCommandAfterUpload(){this.change=1,console.log("change::",this.change)},update(){this.change=1,console.log("change::",this.change)},updatePolylinePath(t){this.polylinePath=t.target.getPath()},changeZoom(t){let e=this.zoom;switch(t){case 1:e+=1;break;case 0:e=17;break;case-1:e-=1;break}e<17?e=17:e>18&&(e=18),console.log(e),this.zoom=e},readExcel(t){const e=t.target.files;if(e.length<=0)return!1;if(!/\.(xls|xlsx)$/.test(e[0].name.toLowerCase()))return this.$Message.error("上传格式不正确，请上传xls或者xlsx格式"),!1;const a=new FileReader;a.onload=e=>{try{const t=e.target.result,a=(0,ht.LF)(t,{type:"binary"}),s=a.SheetNames[0],i=ht.Wp.sheet_to_json(a.Sheets[s]);console.log("处理之后的文件数据是：：",i),console.log("数据个数为：",i.length),console.log("插入经纬度坐标为:"),this.center.lng=i[0].clng,this.center.lat=i[0].clat,this.zoom=i[0].zoom,console.log("325",this.center.lng,this.center.lat,this.zoom);for(let e=0;e<i.length;e++)console.log("(",i[e].lng,i[e].lat,")"),this.PathPoint=i;console.log(this.PathPoint)}catch(t){return!1}this.setPoint()},a.readAsBinaryString(e[0])},setPoint(){let t={Clng:Number(this.center.lng),Clat:Number(this.center.lat),zoom:Number(this.zoom),pathdata:this.PathPoint};console.log(t),Z(t).then((t=>{1===t.code?(console.log(t.message),this.getCenter(),this.getPath(),this.getTempHttp(0)):this.$Message.error(t.message)}))},getCenter(){B().then((t=>{1===t.code?(this.center.lng=t.data.lng,this.center.lat=t.data.lat,this.zoom=t.data.zoom,console.log("232",t)):0===t.code&&this.$Message.error(t.message)}))},getPath(){z().then((t=>{1===t.code?(this.PathPoint=t.data.pathData,console.log("244",t),this.getTempHttp(0)):0===t.code&&this.$Message.error(t.message)}))},mockLocation(){console.log("polyline func inside");let t=[],e=this.PathPoint;console.log("inPoint:",e);let a=0,s=[];for(let n=0;n<e.length-1;n++){let t=e[n+1].lng-e[n].lng,i=e[n+1].lat-e[n].lat,o=Math.sqrt(Math.pow(t,2)+Math.pow(i,2));a+=o,s.push({lng:t,lat:i,ab:o})}console.log("totalpath:",a);let i=this.datanum,o=a/(i-1);for(let n=0;n<e.length-1;n++)s[n].count=s[n].ab/o,s[n].intlng=s[n].lng/s[n].count,s[n].intlat=s[n].lat/s[n].count;console.log("dis:",s);for(let n=0;n<this.PathPoint.length-1;n++)for(let a=0;a<s[n].count;a++)t.push({lng:Number((e[n].lng+a*s[n].intlng).toFixed(6)),lat:Number((e[n].lat+a*s[n].intlat).toFixed(6))});while(t.length>i)t.pop();this.locationPoint=t},clearTimer(){clearInterval(this.timer)},getTempHttp(t){let e={time:t};D(e).then((t=>{1===t.code?(this.chartData=t.data.temp,this.datanum=this.chartData.length,console.log("num:",this.datanum),console.log("polyline start"),this.mockLocation(),this.addTempData(),this.getLimitPoint(),this.$nextTick((()=>{this.change=!this.change,this.change=!this.change}))):0===t.code&&this.$Message.error(t.message)}))},getTempData(){this.timer=setInterval((()=>{console.log("timer working"),this.getTempHttp(0),this.addTempData(),this.getLimitPoint()}),this.interval)},addTempData(){for(let t=0;t<this.datanum;t++)this.locationPoint[t].value=this.chartData[t].toFixed(4)},clickPoint(t){console.log("addtemppath:");let e={lng:t.point.lng,lat:t.point.lat},a=this.locationPoint.map((t=>{let a=Math.sqrt(Math.pow(t.lng-e.lng,2)+Math.pow(t.lat-e.lat,2));return{dis:a,lng:t.lng,lat:t.lat,value:t.value}}));a.sort(this.compare("dis")),this.pointInfo=a[0],this.showWindow=!0,this.$Notice.destroy(),this.infoWindowOpen(1);let s=this.infoWindow.contents1+"<br />"+this.infoWindow.contents2;this.$Notice.info({title:"当前坐标数据详情",desc:s,duration:0,top:100})},compare(t){return function(e,a){var s=e[t],i=a[t];return s-i}},getLimitPoint(){this.limitPonit=this.locationPoint.filter((t=>t.value>this.limit))},infoWindowClose(){this.showWindow=!1},clickMark(t){this.targetLimit=this.limitPonit.find((e=>e.lng===t.target.point.lng&&e.lat===t.target.point.lat)),this.showLimit=!0,this.$Notice.destroy(),this.infoWindowOpen(2);let e=this.infoWindow.contents1+"<br />"+this.infoWindow.contents2;this.$Notice.warning({title:"告警点数据详情",desc:e,duration:0})},infoWindowlimitClose(){this.showLimit=!1},infoWindowOpen(t){let e=[];2===t?e=this.targetLimit:1===t&&(e=this.pointInfo),this.infoWindow.contents1="【坐标】<br />lng："+String(e.lng)+"  lat："+String(e.lat),this.infoWindow.contents2="【温度】<br />"+String(e.value)+"℃",2===t?this.showLimit=!0:1===t&&(this.showWindow=!0)}}},dt=ut,pt=(0,g.A)(dt,rt,lt,!1,null,"2bb3b550",null),mt=pt.exports,gt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"table"},[e("div",{staticClass:"table-title"},[e("span",{staticClass:"first-title"},[t._v("参数设置")]),e("span",{staticClass:"second-title"},[t._v("/ "+t._s(t.$route.query.mname))])]),e("div",{staticClass:"subMenu-selector",staticStyle:{width:"200px",padding:"0 0 20px 20px"}},[e("Select",{on:{"on-change":t.selectSubMenu},model:{value:t.targetSub,callback:function(e){t.targetSub=e},expression:"targetSub"}},t._l(t.allSubMenu,(function(a,s){return e("Option",{key:s,attrs:{value:a.sid}},[t._v(t._s(a.sname))])})),1)],1),e("div",{staticClass:"table-spin"},[e("div",{staticClass:"table-button"},[e("Button",{directives:[{name:"show",rawName:"v-show",value:"3"===t.mid,expression:"mid === '3'"}],staticClass:"button-set",attrs:{type:"primary"},on:{click:t.showDataModal}},[t._v("查看数据库")]),e("Modal",{attrs:{title:"数据库数据",width:"60%"},scopedSlots:t._u([{key:"footer",fn:function(){return[e("Button",{attrs:{type:"primary"},on:{click:t.applyData}},[t._v("一键应用")]),e("Button",{on:{click:t.closeModal}},[t._v("关闭")])]},proxy:!0}]),model:{value:t.dataModalVisible,callback:function(e){t.dataModalVisible=e},expression:"dataModalVisible"}},[e("Table",{attrs:{columns:t.columns,data:t.databaseData,border:"","span-method":t.handleSpan}})],1),e("Button",{directives:[{name:"show",rawName:"v-show",value:"3"===t.mid,expression:"mid === '3'"}],staticClass:"button-set",attrs:{type:"primary"},on:{click:t.backUp}},[t._v("备份数据")]),e("Button",{staticClass:"button-set",attrs:{type:"primary"},on:{click:function(e){t.showModal=!0}}},[t._v("添加参数")]),e("Modal",{attrs:{title:"添加参数",width:"600","footer-hide":!0},model:{value:t.showModal,callback:function(e){t.showModal=e},expression:"showModal"}},[e("paraform",{ref:"paraform",on:{formSubmitted:t.handleFormSubmitted}})],1),e("Button",{directives:[{name:"show",rawName:"v-show",value:"4"===t.mid,expression:"mid === '4'"}],staticClass:"button-set",staticStyle:{"background-color":"#FF7D45","border-color":"#FF7D45"},attrs:{type:"primary"},on:{click:function(e){t.showAdvancedParams=!0}}},[t._v("高级参数")]),e("Modal",{staticClass:"advanced-params-modal",attrs:{title:"高级参数设置",width:"650","mask-closable":!1},model:{value:t.showAdvancedParams,callback:function(e){t.showAdvancedParams=e},expression:"showAdvancedParams"}},[e("div",{staticClass:"advanced-params-container"},[e("div",{staticClass:"param-group"},[e("div",{staticClass:"param-group-header"},[e("Icon",{staticClass:"param-group-icon",attrs:{type:"ios-analytics"}}),e("h3",[t._v("采集参数")])],1),e("div",{staticClass:"param-items"},[e("div",{staticClass:"param-item"},[e("Checkbox",{staticClass:"large-checkbox",model:{value:t.params.highAccuracy,callback:function(e){t.$set(t.params,"highAccuracy",e)},expression:"params.highAccuracy"}},[e("span",{staticClass:"param-label"},[t._v("高精度模式")]),e("span",{staticClass:"param-desc"},[t._v("(提高数据精度但会降低采集速度)")])])],1),e("div",{staticClass:"param-item"},[e("Checkbox",{staticClass:"large-checkbox",model:{value:t.params.enableDebugLog,callback:function(e){t.$set(t.params,"enableDebugLog",e)},expression:"params.enableDebugLog"}},[e("span",{staticClass:"param-label"},[t._v("启用失败自动采集")]),e("span",{staticClass:"param-desc"},[t._v("(失败后自动尝试重新采集)")])])],1)])]),e("div",{staticClass:"param-group"},[e("div",{staticClass:"param-group-header"},[e("Icon",{staticClass:"param-group-icon",attrs:{type:"ios-globe"}}),e("h3",[t._v("网络设置")])],1),e("div",{staticClass:"param-items"},[e("div",{staticClass:"param-item"},[e("Checkbox",{staticClass:"large-checkbox",model:{value:t.params.forceIPv4,callback:function(e){t.$set(t.params,"forceIPv4",e)},expression:"params.forceIPv4"}},[e("span",{staticClass:"param-label"},[t._v("使用IPv4")])])],1),e("div",{staticClass:"param-item"},[e("Checkbox",{staticClass:"large-checkbox",model:{value:t.params.bypassProxy,callback:function(e){t.$set(t.params,"bypassProxy",e)},expression:"params.bypassProxy"}},[e("span",{staticClass:"param-label"},[t._v("绕过代理")]),e("span",{staticClass:"param-desc"},[t._v("(直接连接目标服务器)")])])],1)])]),e("div",{staticClass:"param-group"},[e("div",{staticClass:"param-group-header"},[e("Icon",{staticClass:"param-group-icon",attrs:{type:"ios-speedometer"}}),e("h3",[t._v("性能调节")])],1),e("div",{staticClass:"param-item-horizontal"},[e("span",{staticClass:"param-label"},[t._v("采样间隔(ms):")]),e("InputNumber",{staticClass:"styled-input-number",attrs:{min:10,max:5e3},model:{value:t.params.sampleInterval,callback:function(e){t.$set(t.params,"sampleInterval",e)},expression:"params.sampleInterval"}}),e("span",{staticClass:"param-unit"},[t._v("毫秒")])],1)])]),e("div",{staticClass:"modal-footer",attrs:{slot:"footer"},slot:"footer"},[e("Button",{staticClass:"cancel-btn",on:{click:function(e){t.showAdvancedParams=!1}}},[t._v("取消")]),e("Button",{staticClass:"confirm-btn",attrs:{type:"primary"},on:{click:t.saveAdvancedParams}},[t._v("保存设置")])],1)]),e("Button",{staticClass:"button-set",attrs:{type:"primary"},on:{click:t.setPara}},[t._v("设置")]),e("Button",{staticClass:"button-set",on:{click:t.queryParaAll}},[t._v("全部刷新")]),e("Button",{directives:[{name:"show",rawName:"v-show",value:"4"===t.mid,expression:"mid === '4'"}],staticClass:"button-set",attrs:{type:"primary"},on:{click:t.startCollecting}},[t._v("开始采集")])],1),e("div",{staticClass:"table-content"},[e("Table",{key:t.DOMkey,ref:"paraTable",attrs:{border:"",stripe:"",columns:t.tcols,data:t.tdata,"span-method":t.handleSpan}}),t.spinTrans?e("Spin",{attrs:{fix:""}},[e("Icon",{staticClass:"demo-spin-icon-load",attrs:{type:"ios-loading",size:"18"}}),e("div",[t._v("数据加载中")])],1):t._e()],1),t.spinShow?e("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)])},ft=[],vt=(a(8872),function(){var t=this,e=t._self._c;return e("Form",{ref:"formValidate",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-width":120}},[e("FormItem",{attrs:{label:"参数名称",prop:"para_name"}},[e("Input",{attrs:{placeholder:"输入参数名称"},model:{value:t.formValidate.para_name,callback:function(e){t.$set(t.formValidate,"para_name",e)},expression:"formValidate.para_name"}})],1),e("FormItem",{attrs:{label:"参数代码",prop:"para_code"}},[e("Input",{attrs:{placeholder:"输入参数代码,四位数字例如5000，5001开始;保证唯一性"},model:{value:t.formValidate.para_code,callback:function(e){t.$set(t.formValidate,"para_code",e)},expression:"formValidate.para_code"}})],1),e("FormItem",{attrs:{label:"参数类型",prop:"type_name"}},[e("Select",{attrs:{placeholder:"选择参数类型"},model:{value:t.formValidate.type_name,callback:function(e){t.$set(t.formValidate,"type_name",e)},expression:"formValidate.type_name"}},[e("Option",{attrs:{value:"功率参数"}},[t._v("功率参数")]),e("Option",{attrs:{value:"电流参数"}},[t._v("电流参数")]),e("Option",{attrs:{value:"温度参数"}},[t._v("温度参数")]),e("Option",{attrs:{value:"无"}},[t._v("无")])],1)],1),e("FormItem",{attrs:{label:"参数长度",prop:"longth"}},[e("RadioGroup",{model:{value:t.formValidate.longth,callback:function(e){t.$set(t.formValidate,"longth",e)},expression:"formValidate.longth"}},[e("Radio",{attrs:{label:"8"}},[t._v("8位")]),e("Radio",{attrs:{label:"16"}},[t._v("16位")]),e("Radio",{attrs:{label:"32"}},[t._v("32位")])],1)],1),e("FormItem",{attrs:{label:"是否可修改",prop:"writeable"}},[e("RadioGroup",{model:{value:t.formValidate.writeable,callback:function(e){t.$set(t.formValidate,"writeable",e)},expression:"formValidate.writeable"}},[e("Radio",{attrs:{label:"1"}},[t._v("是")]),e("Radio",{attrs:{label:"0"}},[t._v("否")])],1)],1),e("FormItem",{attrs:{label:"参数值",prop:"write_value"}},[e("Input",{attrs:{placeholder:"输入参数值"},model:{value:t.formValidate.write_value,callback:function(e){t.$set(t.formValidate,"write_value",e)},expression:"formValidate.write_value"}})],1),e("FormItem",{attrs:{label:"参数单位",prop:"unit"}},[e("Input",{attrs:{placeholder:"输入参数单位可为空"},model:{value:t.formValidate.unit,callback:function(e){t.$set(t.formValidate,"unit",e)},expression:"formValidate.unit"}})],1),e("FormItem",{attrs:{label:"参数所属位置",prop:"farther_submenu"}},[e("Select",{attrs:{placeholder:"选择所属位置"},model:{value:t.formValidate.farther_submenu,callback:function(e){t.$set(t.formValidate,"farther_submenu",e)},expression:"formValidate.farther_submenu"}},[e("Option",{attrs:{value:"1"}},[t._v("采样参数")]),e("Option",{attrs:{value:"2"}},[t._v("关系参数")]),e("Option",{attrs:{value:"3"}},[t._v("洛伦兹系数")]),e("Option",{attrs:{value:"4"}},[t._v("编码控制激光器")]),e("Option",{attrs:{value:"5"}},[t._v("EDFA泵浦")]),e("Option",{attrs:{value:"6"}},[t._v("SOA")]),e("Option",{attrs:{value:"7"}},[t._v("探测器功率")]),e("Option",{attrs:{value:"8"}},[t._v("botda")])],1)],1),e("FormItem",[e("Button",{attrs:{type:"primary"},on:{click:function(e){return t.handleSubmit("formValidate")}}},[t._v("提交")]),e("Button",{staticStyle:{"margin-left":"8px"},on:{click:function(e){return t.handleReset("formValidate")}}},[t._v("重置")])],1)],1)}),yt=[],bt={data(){return{formValidate:{para_name:"",para_code:"",type_name:"",longth:"32",writeable:"",write_value:"",unit:"",farther_submenu:""},ruleValidate:{para_name:[{required:!0,message:"不可为空",trigger:"blur"}],para_code:[{required:!0,message:"不可为空",trigger:"blur"},{type:"string",max:4,message:"要求4位数字",trigger:"blur"},{type:"string",min:4,message:"要求4位数字",trigger:"blur"}],type_name:[{required:!0,message:"请选择参数类型",trigger:"change"}],longth:[{required:!0,message:"请选择参数长度",trigger:"change"}],writeable:[{required:!0,message:"请选择参数以后是否可以被修改",trigger:"change"}],write_value:[{type:"string",message:"可为空",trigger:"blur"}],unit:[{type:"string",message:"请输入参数单位，可为空",trigger:"blur"}],farther_submenu:[{required:!0,message:"请选择参数所属位置",trigger:"change"}]}}},methods:{handleSubmit(t){this.$refs[t].validate((t=>{if(t){console.log(this.formValidate);let t={para_name:this.formValidate.para_name,para_code:this.formValidate.para_code,type_name:this.formValidate.type_name,longth:this.formValidate.longth,writable:this.formValidate.writeable,write_value:this.formValidate.write_value,unit:this.formValidate.unit,farther_submenu:this.formValidate.farther_submenu};R(t).then((t=>{1===t.code?(this.$emit("formSubmitted"),this.$Message.success("设置成功")):this.$Message.error(t.message)}))}else this.$Message.error("Fail!")}))},handleReset(t){this.$refs[t].resetFields(),this.$Message.success("Success!")}}},wt=bt,Mt=(0,g.A)(wt,vt,yt,!1,null,null,null),kt=Mt.exports;const xt={"功率参数":"green","电流参数":"blue","温度参数":"red"};var St={name:"paraTable",components:{paraform:kt},data(){return{pollingInterval:null,collectionStatus:0,showAdvancedParams:!1,params:{highAccuracy:!1,enableDebugLog:!1,forceIPv4:!0,bypassProxy:!1,sampleInterval:100},mid:"",mcode:"",targetSub:"",allSubMenu:[],paraList:[],typeNumList:[],tselection:[],inputSetValue:{},selectRealData:[],spinShow:!1,spinTrans:!1,DOMkey:0,showModal:!1,dataModalVisible:!1,columns:[{title:"参数类型",key:"type",align:"center",render:(t,{row:e})=>t("Tag",{props:{color:xt[e.type]||"default"}},e.type||"无")},{title:"参数名称",key:"pname",align:"center",render:(t,{row:e})=>t("strong",e.pname||"无")},{title:"设置值",key:"setValue",align:"center",render:(t,{row:e})=>t("div",[t("Icon",{props:{type:"ios-alert",color:"#ff9900"},style:{marginRight:"5px"}}),t("span",e.setValue||"无")])}],databaseData:[]}},created(){this.mid=this.$route.query.mid,this.mcode=this.$route.query.mcode,this.getAllSubMenu()},beforeRouteUpdate(t,e,a){console.log(t.query),this.mid=t.query.mid,this.mcode=t.query.mcode,this.getAllSubMenu(),a()},computed:{tcols(){return[{title:"参数类型",key:"type",align:"center",width:150},{title:"参数名称",align:"center",key:"pname"},{title:"查询值",align:"center",key:"readValue"},{title:"设置值",align:"center",key:"setValue",render:(t,e)=>!1===e.row.writable?t("span",e.row.setValue):t("Input",{style:{margin:"5px",width:"90px"},props:{type:"text",value:e.row.setValue},on:{"on-blur":t=>{let a=JSON.stringify(t.target.value),s=0;""==t.target.value&&(a.replace(/""/g,"null"),t.target.value=JSON.parse(a),s+=1,console.log("onblur-input:",t.target.value)),e.row.setValue=t.target.value,this.selectRealData.forEach((a=>{a.pid==e.row.pid&&(a.setValue=e.row.setValue,s+=1),this.selectRealData[e.index].setValue=t.target.value})),this.selectRealData=this.selectRealData.filter((t=>""!==t.setValue)),0==s&&this.selectRealData.push(e.row),console.log("selectRealData:",this.selectRealData)},input:t=>{console.log("input1:",t)},"on-focus":()=>{console.log("on-focus1")}},nativeOn:{keyup:t=>{"enter"===t.key.toLowerCase()&&(e.row.setValue=t.target.value)}}})},{title:"单位",align:"center",key:"unit"},{title:"刷新时间",align:"center",key:"time"},{title:"操作",key:"action",width:80,render:(t,e)=>t("Button",{props:{size:"small"},style:{backgroundColor:"#FF4D4F",borderColor:"#FF4D4F",color:"#FFFFFF"},on:{click:()=>{this.handleRowAction(e.row)}}},"删除")}]},tdata(){return this.paraList},formattedData(){return this.databaseData?JSON.stringify(this.databaseData,null,2):"暂无数据"}},methods:{saveAdvancedParams(){this.$Message.success("高级参数已保存"),this.showAdvancedParams=!1,console.log("当前参数配置:",this.params)},applyData(){this.$Message.success("数据应用成功"),this.dataModalVisible=!1},closeModal(){this.dataModalVisible=!1},async showDataModal(){try{const t={"功率参数":1,"电流参数":2,"温度参数":3,"未知类型":999};this.databaseData=this.tdata.map((t=>({type:t.type||"未知类型",pname:t.pname||"未知名称",setValue:void 0!==t.setValue?t.setValue:"未设置"}))).sort(((e,a)=>{const s=t[e.type]||t["未知类型"],i=t[a.type]||t["未知类型"];return s-i})),this.dataModalVisible=!0,console.log(this.databaseData)}catch(t){console.error("获取数据失败:",t),this.$Message.error("获取数据失败")}},backUp(){console.log("111")},deleteRowData(t){let e={pcode:Number(t)};console.log("删除参数的编号：",t),L(e).then((t=>{1===t.code?(this.$Message.success("数据删除成功"),location.reload()):this.$Message.error(t.message)}))},handleRowAction(t){this.$Modal.confirm({title:"确认提示",content:"确定要执行此操作吗？",onOk:()=>{this.deleteRowData(t.pcode)},onCancel:()=>{this.$Message.info("操作已取消")}})},handleFormSubmitted(){this.showModal=!1,this.selectSubMenu(),location.reload()},getAllSubMenu(){let t={mid:Number(this.mid)};F(t).then((t=>{1===t.code?(this.allSubMenu=t.data.subMenu,this.targetSub=this.allSubMenu[0].sid,this.selectSubMenu()):this.$Message.error(t.message)}))},selectSubMenu(){let t={sid:this.targetSub};this.spinTrans=!0,T(t).then((t=>{if(1===t.code){this.paraList=t.data.paraList,this.paraList.forEach((t=>{t&&(t.setValue="")}));let e={};this.paraList.forEach((t=>{"undefined"===typeof e[t.type]?(e[t.type]=[],e[t.type].push(t)):e[t.type].push(t)}));let a=[];for(let t in e)a=a.concat(e[t]),this.typeNumList.push(e[t].length);this.paraList=a,this.spinTrans=!1}else this.$Message.error(t.message),this.spinTrans=!1}))},handleSpan({row:t,column:e,rowIndex:a,columnIndex:s}){if(this.typeNumList.length){let t=this.typeNumList.reduce(((t,e)=>t+e));for(let e=0,i=0;e<=t-this.typeNumList[this.typeNumList.length-1];e+=this.typeNumList[i-1]){if(0===s&&a===e)return{rowspan:this.typeNumList[i],colspan:1};for(let t=e;t<e+this.typeNumList[i];t++)if(0===s&&a===t)return[0,0];i++}}},setPara(){for(let e of this.selectRealData){if(isNaN(e.setValue)||!e.setValue)
//!Boolean(item.setValue),修改了，已经是布尔值了
return this.$Message.error({content:e.pname+"的设置值未输入或输入非数字，请重新输入",duration:3}),0;Number(e.setValue)>=Math.pow(2,e.longth)&&this.$Message.error({content:e.pname+"的设置值超出限制，最大为"+Math.pow(2,e.longth),duration:3})}let t={paraList:[]};t.paraList=this.selectRealData.map((t=>({pcode:t.pcode,setValue:t.setValue}))),console.log("316set",t),$(t).then((e=>{console.log(t),1===e.code?(this.$Loading.finish(),this.spinShow=!1,this.$Message.success("设置成功"),this.selectRealData=this.selectRealData.map((t=>({...t,setValue:""}))),this.selectSubMenu()):(this.$Message.error(e.message),this.spinShow=!1,this.$Loading.error())}))},queryParaAll(){console.log("updateALL"),this.selectRealData=this.paraList,this.selectSubMenu(),this.selectRealData=[]},startCollecting(){let t=this.paraList.map((t=>t.readValue)).slice(0,15);H({arg:t}).then((t=>{console.log("开始采集状态",t)})),this.$Message.success("开始采集"),this.startPolling()},startPolling(){console.log("开始态"),this.pollingInterval=setInterval((async()=>{try{q().then((t=>{console.log("轮询采集状态",t),0===t.completed&&(clearInterval(this.pollingInterval),this.collectionStatus=2,this.$Message.success("采集完成"),console.log("获得数据:",t.data))}))}catch(t){console.error("轮询错误:",t),clearInterval(this.pollingInterval),this.collectionStatus=0}}),2e3)}}},Ct=St,Dt=(0,g.A)(Ct,gt,ft,!1,null,null,null),_t=Dt.exports,Pt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"upload-wrapper"},[e("h3",{staticClass:"title"},[t._v("文件上传")]),e("div",{staticClass:"upload-group",staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{staticStyle:{display:"flex",gap:"20px"}},[e("div",{staticClass:"upload-item",staticStyle:{display:"flex",gap:"10px"}},[e("input",{ref:"binInput",staticStyle:{display:"none"},attrs:{type:"file",accept:".bin"},on:{change:function(e){return t.handleFileSelect("bin")}}}),e("Button",{staticStyle:{height:"36px",padding:"0 16px"},attrs:{type:"success",size:"small"},on:{click:function(e){return t.openFileDialog("bin")}}},[e("Icon",{attrs:{type:"ios-archive-outline"}}),t._v(" 上传BIN文件 ")],1)],1),e("div",{staticClass:"upload-item"},[e("input",{ref:"folderInput",staticStyle:{display:"none"},attrs:{type:"file",webkitdirectory:"",directory:"",multiple:"",accept:"*"},on:{change:function(e){return t.handleFileSelect("folder")}}}),e("Button",{staticStyle:{height:"36px",padding:"0 16px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.openFileDialog("folder")}}},[e("Icon",{attrs:{type:"ios-folder-open-outline"}}),t._v(" 上传系统文件夹 ")],1)],1)]),e("Button",{staticStyle:{height:"36px",padding:"0 16px"},attrs:{type:"error",size:"small"},on:{click:t.confirmReset}},[e("Icon",{attrs:{type:"ios-refresh"}}),t._v(" 恢复出厂设置 ")],1)],1),t.uploadedFiles.length>0?e("div",{staticClass:"uploaded-files"},[e("h4",{staticClass:"subtitle"},[t._v("已上传文件")]),e("div",{staticClass:"file-list"},t._l(t.uploadedFiles,(function(a,s){return e("div",{key:s,staticClass:"file-item"},[e("i",{staticClass:"ivu-icon ivu-icon-document-text"}),e("span",{staticClass:"file-name"},[t._v(" "+t._s(a.relativePath||a.name)+" ")]),e("span",{staticClass:"file-size"},[t._v(t._s(a.size))]),a.url?e("a",{staticClass:"file-action",attrs:{href:a.url,target:"_blank"}},[e("i",{staticClass:"ivu-icon ivu-icon-download"}),t._v(" 下载 ")]):t._e(),e("Button",{staticClass:"file-action",attrs:{type:"error",size:"small"},on:{click:function(e){return t.removeFile(s)}}},[e("i",{staticClass:"ivu-icon ivu-icon-ios-trash-outline"}),t._v(" 删除 ")])],1)})),0)]):t._e()])},It=[],At={data(){return{uploadedFiles:[]}},methods:{confirmReset(){this.$Modal.confirm({title:"确认恢复出厂设置",render:t=>t("div",[t("p","此操作将重置所选内容到初始状态，且不可恢复！"),t("div",{style:{margin:"16px 0"}},[t("Checkbox",{props:{value:this.resetBinChecked},on:{"on-change":t=>{this.resetBinChecked=t}},style:{display:"block",marginBottom:"8px"}},"重置BIN文件"),t("Checkbox",{props:{value:this.resetFolderChecked},on:{"on-change":t=>{this.resetFolderChecked=t}},style:{display:"block"}},"重置系统文件")]),t("p","确定要继续吗？")]),onOk:()=>{const t=[];if(this.resetBinChecked&&t.push("bin"),this.resetFolderChecked&&t.push("folder"),0===t.length)return this.$Message.warning("请至少选择一个重置选项"),Promise.reject();this.resetToFactorySettings(t)}})},resetToFactorySettings(t){t.includes("bin")&&console.log("重置BIN文件"),t.includes("folder")&&console.log("重置系统文件"),this.$Message.success("已重置所选内容")},openFileDialog(t){"bin"===t&&this.$refs.binInput.click(),"folder"===t&&this.$refs.folderInput.click()},handleFileSelect(t){const e="bin"===t?"binInput":"folderInput",a=this.$refs[e];if(!a||!a.files||0===a.files.length)return void this.$Message.warning("未选择有效文件");const i=Array.from(a.files),o=new FormData,n="bin"===t?"uploadBit":"uploadSystem",r="bin"===t?"file":"files[]";if("bin"===t){const t=i[0];if(!t||!t.name.endsWith(".bin"))return this.$Message.error("请选择有效的.bin文件"),void(a.value="");o.append(r,t)}else i.forEach((t=>{t&&o.append(r,t,t.webkitRelativePath||t.name)}));s[n](o).then((e=>{1===e.code?(this.handleUploadSuccess(t,i,e.data),a.value=""):this.$Message.error(e.message||"上传失败")})).catch((e=>{this.handleUploadError(e,t)}))},handleUploadSuccess(t,e,a){const s=e.map((e=>({name:e.name||"未命名文件",size:this.formatFileSize(e.size||0),type:t,relativePath:e.webkitRelativePath||"",url:a?.url||a?.urls?.[e.name]||""})));this.uploadedFiles=[...this.uploadedFiles,...s],this.$Message.success(("bin"===t?"BIN文件":"文件夹")+"上传成功")},handleUploadError(t,e){console.error(`${e}上传错误:`,t);let a="上传失败";if(t.response){const e=t.response.status;a=413===e?"文件太大":404===e?"接口不存在":`服务器错误(${e})`}else t instanceof ProgressEvent&&(a="网络连接失败");this.$Message.error(`${"bin"===e?"BIN文件":"文件夹"}${a}`)},formatFileSize(t){if(0===t)return"0 B";const e=1024,a=["B","KB","MB","GB"],s=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,s)).toFixed(2))+" "+a[s]},showStatus(t,e){this.$message({message:t,type:e,duration:1500,showClose:!0})}}},Ot=At,Nt=(0,g.A)(Ot,Pt,It,!1,null,"674ae610",null),Ft=Nt.exports;const Tt=[{path:"/chart",name:"chart",component:nt,meta:{requireAuth:!0,title:"数据曲线",icon:"ios-pulse"}},{path:"/map",name:"map",component:mt,meta:{requireAuth:!0,title:"地图",icon:"ios-map"}},{path:"/table",name:"paraTable",component:_t,meta:{requireAuth:!0,title:"参数设置",icon:"ios-construct"},children:[]},{path:"/update",name:"update",component:Ft,meta:{requireAuth:!0,title:"系统更新",icon:"ios-cloud-upload"}}];var Vt=Tt,Rt={name:"HomeView",components:{Monitor:tt},data(){return{paraMenu:[],menus:Vt}},created(){this.getParaMenu()},mounted(){window.addEventListener("beforeunload",(()=>{sessionStorage.setItem(d,JSON.stringify(this.$store.state)),console.log("home：session重传state",d.state)}))},computed:{...(0,r.aH)(["role","activeMenu","openNames"])},methods:{getParaMenu(){const t={role:this.role};S(t).then((t=>{1===t.code&&(this.paraMenu=t.data.menu)}))}}},Lt=Rt,$t=(0,g.A)(Lt,b,w,!1,null,"06b059ab",null),Et=$t.exports,Bt=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login"},[e("div",{staticClass:"login-card"},[e("div",{staticClass:"login-card-title"},[t._v(" 欢迎登陆 ")]),e("Divider"),e("Input",{staticClass:"login-card-input",attrs:{prefix:"ios-contact",placeholder:"用户名"},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}}),e("Input",{staticClass:"login-card-input",attrs:{type:"password",prefix:"ios-key",placeholder:"密码"},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),e("div",{staticClass:"login-card-button"},[e("Button",{staticClass:"login-button",attrs:{type:"primary",icon:"md-checkmark"},on:{click:t.checkLogin}},[t._v("登陆")]),e("Button",{staticClass:"clear-button",attrs:{icon:"md-close"}},[t._v("重置")])],1),e("div",{staticClass:"login-card-warn"},[t._v(" 创建新用户请联系管理员 ")])],1)])},zt=[],Zt={name:"LoginView",components:{},data(){return{username:"",password:"",role:3}},methods:{checkInput(){return""===this.username||"undefined"===typeof this.username?(this.$Message.warning("请输入用户名"),!1):""!==this.password&&"undefined"!==typeof this.password||(this.$Message.warning("请输入密码"),!1)},checkLogin(){if(this.checkInput()){let t={name:this.username,password:this.password};N(t).then((t=>{1===t.code?(this.role=t.data.role,this.$Message.success("登陆成功"),this.$store.commit("setRole",this.role),this.$store.commit("setName",this.username),this.$router.push({name:"chart"})):this.$Modal.error({title:"登陆失败",content:t.message})}))}}}},Ht=Zt,qt=(0,g.A)(Ht,Bt,zt,!1,null,"46e64ebd",null),Gt=qt.exports;i["default"].use(y.Ay);const Wt=[{path:"/home",name:"home",component:Et,children:Vt},{path:"/login",name:"login",component:Gt},{path:"/admin",name:"admin"},{path:"/",redirect:"/login"},{path:"/offline",name:"offline"}],Jt=new y.Ay({mode:"hash",base:"/",routes:Wt});Jt.beforeEach(((t,e,a)=>{let s;Vt.some(((e,a)=>{if(e.path===t.path)return s=a,!0}))&&d.commit("setActiveMenu",s),a()}));var jt=Jt,Yt=a(928),Ut=a.n(Yt),Xt=a(5098),Kt=(a(8591),a(9710)),Qt=a.n(Kt);i["default"].use(Qt(),{ak:"g80yEv2wS5Ii4wAlv0iLT7BeAU1rYUsj"}),i["default"].prototype.$echarts=Xt,i["default"].use(Ut()),i["default"].config.productionTip=!1,new i["default"]({router:jt,store:d,render:t=>t(v)}).$mount("#app")}},e={};function a(s){var i=e[s];if(void 0!==i)return i.exports;var o=e[s]={exports:{}};return t[s].call(o.exports,o,o.exports,a),o.exports}a.m=t,function(){var t=[];a.O=function(e,s,i,o){if(!s){var n=1/0;for(h=0;h<t.length;h++){s=t[h][0],i=t[h][1],o=t[h][2];for(var r=!0,l=0;l<s.length;l++)(!1&o||n>=o)&&Object.keys(a.O).every((function(t){return a.O[t](s[l])}))?s.splice(l--,1):(r=!1,o<n&&(n=o));if(r){t.splice(h--,1);var c=i();void 0!==c&&(e=c)}}return e}o=o||0;for(var h=t.length;h>0&&t[h-1][2]>o;h--)t[h]=t[h-1];t[h]=[s,i,o]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var s in e)a.o(e,s)&&!a.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={524:0};a.O.j=function(e){return 0===t[e]};var e=function(e,s){var i,o,n=s[0],r=s[1],l=s[2],c=0;if(n.some((function(e){return 0!==t[e]}))){for(i in r)a.o(r,i)&&(a.m[i]=r[i]);if(l)var h=l(a)}for(e&&e(s);c<n.length;c++)o=n[c],a.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return a.O(h)},s=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=a.O(void 0,[504],(function(){return a(3379)}));s=a.O(s)})();
//# sourceMappingURL=app.cb35919d.js.map